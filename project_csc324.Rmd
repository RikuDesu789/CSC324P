---
title: "project"
author: "Riku"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

---
title: "lab-3.Rmd"
author: "Riku"
date: "`r Sys.Date()`"
output: html_document
---



```{r}
library(dplyr)
# cleaning data : convert abbreviated country name to full name
country_names <- c(
  US = "United States",
  UK = "United Kingdom",
  DE = "Germany",
  FR = "France",
  ES = "Spain",
  IT = "Italy",
  NL = "Netherlands",
  BE = "Belgium",
  AT = "Austria",
  CH = "Switzerland",
  PT = "Portugal",
  SE = "Sweden",
  NO = "Norway",
  DK = "Denmark",
  FI = "Finland",
  CZ = "Czech Republic",
  HU = "Hungary",
  PL = "Poland",
  RO = "Romania",
  BG = "Bulgaria",
  GR = "Greece",
  TR = "Turkey"
)

# Add a new column for country name
df$country_name <- sapply(df$country, function(x) country_names[x])
```

```{r}
df = read.csv("/Users/rikusmriga/Desktop/csc324/CSC324P/hotel_bookings.csv")
library(ggplot2)
library(histogram)
library(tidyverse)

# Create a histogram using ggplot2
ggplot(df, aes(x = lead_time)) +
  geom_histogram() +
  labs(x = "Lead time (days)", y = "Count")

# Pivot the data to summarize the number of bookings by country of origin
booking_by_country <- df %>%
  group_by(country) %>%
  tally() %>%
  arrange(desc(n))

booking_by_country
```

```{r}
summary(df)

table(df$hotel)

table(df$arrival_date_month)

tapply(df$lead_time, df$market_segment, mean)

tapply(df$adr, df$country, mean)

table(df$reservation_status)

# Create a bar plot of the number of bookings by hotel type
ggplot(df, aes(x = hotel, y = n)) +
  geom_bar(stat = "sum") +
  labs(title = "Number of Bookings by Hotel Type")

# Create a line plot of the average lead time by market segment
ggplot(df, aes(x = market_segment, y = lead_time)) +
  geom_line() +
  labs(title = "Average Lead Time by Market Segment")

# Create a scatter plot of the ADR by country
ggplot(df, aes(x = country, y = adr)) +
  geom_point() +
  labs(title = "ADR by Country")

# Perform a linear regression to predict ADR based on lead time and market segment
model <- lm(adr ~ lead_time + market_segment, data = df)


summary(model)
```
# visualization 
```{r}
library(shiny)
library(ggplot2)

# Load the data
df <- read.csv("/Users/rikusmriga/Desktop/csc324/CSC324P/data/hotel_bookings.csv")

# Define the UI
ui <- fluidPage(
  titlePanel("Bar Plot Selector"),
  sidebarLayout(
    sidebarPanel(
      selectInput("column_name", "Select Column:", choices = colnames(df)),
      hr(),
      helpText("Choose a column.")
    ),
    mainPanel(plotOutput("barPlot"))
  )
)

# Define the server
server <- function(input, output) {
  
  # Render a bar plot based on the selected column
  output$barPlot <- renderPlot({
    if (!is.null(input$column_name)) {
      ggplot(df, aes(x = df[[input$column_name]])) +
        geom_bar(fill = "blue", color = "black") +
        labs(title = paste("Bar Plot of", input$column_name), y = "Count", x = input$column_name) +
        theme_minimal()
    }
  })
}

# Run the Shiny app
shinyApp(ui = ui, server = server)
```

```{r}
library(dplyr) 
library(ggplot2)
# Create a line plot of the number of bookings by month
df %>%
  group_by(arrival_date_month) %>%
  summarise(total_bookings = n()) %>%
  ggplot(aes(x = arrival_date_month, y = total_bookings, group = 1)) +
  geom_line() +
  labs(title = "Booking Trends Over Time", x = "Month", y = "Total Bookings")
```

```{r}
# Create a pie chart of market segment distribution
df %>%
  group_by(market_segment) %>%
  summarise(total_bookings = n()) %>%
  ggplot(aes(x = "", y = total_bookings, fill = market_segment)) +
  geom_bar(stat = "identity") +
  coord_polar("y", start = 0) +
  labs(title = "Market Segment Distribution")
```



```{r}
library(shiny)
library(ggplot2)
library(dplyr)

# Load the data
df <- read.csv(path)

# Define the UI
ui <- fluidPage(
  shinythemes::themeSelector(), 
  titlePanel("Hotel Bookings Analysis"),
  
  tabsetPanel(
    tabPanel("Visualization", 
      fluidRow(
        column(4,
          selectInput("x_value", "X-Axis Value:", choices = colnames(df)),
          selectInput("y_value", "Y-Axis Value:", choices = colnames(df)),
          selectInput("plot_type", "Select Plot Type:",
                      choices = c("Scatter Plot", "Bar Plot", "Line Plot")),
           downloadButton("download_data", "Download Data", class = "btn-primary")
        ),
        column(8,
          plotOutput("plot")
        )
      ),
      fluidRow(
        column(6,
          verbatimTextOutput("summary_stats")
        ),
      )
    ),
    tabPanel("Dummy Tab 1"),
    tabPanel("Dummy Tab 2"),
    tabPanel("Settings",
      div(
        id = "settings",
        selectInput("app_theme", "Select App Theme:",
                    choices = c("Default", "Minimal", "Classic", "Dark", "Light")),
        selectInput("text_size", "Select Text Size:",
                    choices = c("Small", "Medium", "Large")),
        selectInput("font_color", "Select Font Color:",
                    choices = c("Black", "Red", "Blue", "Green")),
        actionButton("apply_settings", "Apply Settings", class = "btn-primary"),
        actionButton("reset_settings", "Reset Settings", class = "btn-secondary"),
        style = "margin: 20px;"
      )
    )
  )
)


# Define the server
server <- function(input, output, session) {
  
  # Function to apply the selected settings
  observeEvent(input$apply_settings, {
    # Apply theme
    if (input$app_theme == "Minimal") {
      theme_selected <- theme_minimal()
    } else if (input$app_theme == "Classic") {
      theme_selected <- theme_classic()
    } else if (input$app_theme == "Dark") {
      theme_selected <- theme_dark()
    } else if (input$app_theme == "Light") {
      theme_selected <- theme_light()
    } else {
      theme_selected <- NULL
    }
    
    if (!is.null(theme_selected)) {
      theme_set(theme_selected)
    }
    
    # Apply text size
    if (input$text_size == "Small") {
      text_size_selected <- "10px"
    } else if (input$text_size == "Medium") {
      text_size_selected <- "12px"
    } else if (input$text_size == "Large") {
      text_size_selected <- "16px"
    } else {
      text_size_selected <- NULL
    }
    
    if (!is.null(text_size_selected)) {
      tags$style(HTML(paste(".control-group { font-size: ", text_size_selected, "; }")))
    }
    
    # Apply font color
    if (input$font_color == "Black") {
      font_color_selected <- "black"
    } else if (input$font_color == "Red") {
      font_color_selected <- "red"
    } else if (input$font_color == "Blue") {
      font_color_selected <- "blue"
    } else if (input$font_color == "Green") {
      font_color_selected <- "green"
    } else {
      font_color_selected <- NULL
    }
    
    if (!is.null(font_color_selected)) {
      tags$style(HTML(paste(".control-group { color: ", font_color_selected, "; }")))
    }
  })
  
  # Reset the settings when the "Reset Settings" button is clicked
  observeEvent(input$reset_settings, {
    theme_set(NULL)  # Reset the theme
    tags$style(HTML(".control-group { font-size: 12px; }"))  # Reset text size
    tags$style(HTML(".control-group { color: black; }"))     # Reset font color
  })
  
  # Create a custom data set base on the user input. This data will be the content of the downloadable csv
  filtered_data <- reactive({
    filtered_df <- df
    if (!is.null(input$x_value) && !is.null(input$y_value)) {
      filtered_df <- filtered_df %>%
        select(all_of(input$x_value), all_of(input$y_value))
    }
    return(filtered_df)
  })
  
  # Render the selected plot (either scatter plot, bar plot, or a bar plot)
  output$plot <- renderPlot({
    if (input$plot_type == "Scatter Plot") {
      ggplot(filtered_data(), aes(x = .data[[input$x_value]], y = .data[[input$y_value]])) +
        geom_point() +
        labs(x = input$x_value, y = input$y_value, title = "Scatter Plot")
    } else if (input$plot_type == "Bar Plot") {
      ggplot(filtered_data(), aes(x = .data[[input$x_value]], fill = .data[[input$y_value]])) +
        geom_bar() +
        labs(x = input$x_value, y = "Count", title = "Bar Plot")
    } else if (input$plot_type == "Line Plot") {
      ggplot(filtered_data(), aes(x = .data[[input$x_value]], y = .data[[input$y_value]])) +
        geom_line() +
        labs(x = input$x_value, y = input$y_value, title = "Line Plot")
    }
  })
  
  # summary statistics
  output$summary_stats <- renderPrint({
    summary(filtered_data())
  })
  
  # Download filtered data as csv
  output$download_data <- downloadHandler(
    filename = function() {
      paste("filtered_data_", Sys.Date(), ".csv", sep = "")
    },
    content = function(file) {
      write.csv(filtered_data(), file)
    }
  )
}

# Run the Shiny app
shinyApp(ui = ui, server = server)

```
